var initWmeSdkPlus=function(){"use strict";var Ir=Object.defineProperty,Pr=(n,t,o)=>t in n?Ir(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ht=(n,t,o)=>Pr(n,typeof t!="symbol"?t+"":t,o),Ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vt={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var Ct;function Rr(){if(Ct)return Vt;Ct=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Ft=="object"?Ft:typeof self=="object"?self:typeof this=="object"?this:T(),y=g(t);typeof a.Reflect<"u"&&(y=g(a.Reflect,y)),o(y,a),typeof a.Reflect>"u"&&(a.Reflect=t);function g($,I){return function(j,A){Object.defineProperty($,j,{configurable:!0,writable:!0,value:A}),I&&I(j,A)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function T(){return S()||O()}})(function(o,a){var y=Object.prototype.hasOwnProperty,g=typeof Symbol=="function",S=g&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=g&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",$={__proto__:[]}instanceof Array,I=!T&&!$,j={create:T?function(){return q(Object.create(null))}:$?function(){return q({__proto__:null})}:function(){return q({})},has:I?function(e,r){return y.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return y.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},A=Object.getPrototypeOf(Function),x=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),P=g?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ge(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!R(s))throw new TypeError;return R(s)&&(s=void 0),i=E(i),ve(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=E(s)),te(e,r,i,s)}o("defineMetadata",C);function L(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),Q(e,r,i)}o("hasMetadata",L);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=E(i)),!b(r))throw new TypeError;d(i)||(i=E(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ge(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!R(h)){if(!se(h))throw new TypeError;r=h}}return r}function ve(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!R(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return R(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!R(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,w=h;l<w.length;l++){var c=w[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function R(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function E(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===A||r!==A)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(P)&&typeof a.Reflect<"u"&&!(P in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,w){if(!d(r)){if(r.isProviderFor(l,w))return r;if(!d(i)){if(i.isProviderFor(l,w))return r;if(!d(s))for(var _=ce(s);;){var v=le(_);if(!v)return;var M=fe(v);if(M.isProviderFor(l,w))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,w))return e}function u(l,w){var _=h.get(l),v;return d(_)||(v=_.get(w)),d(v)&&(v=p(l,w),d(v)||(d(_)&&(_=new x,h.set(l,_)),_.set(w,v))),v}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,w,_){if(!c(_))throw new Error("Metadata provider not registered.");var v=u(l,w);if(v!==_){if(!d(v))return!1;var M=h.get(l);d(M)&&(M=new x,h.set(l,M)),M.set(w,_)}return!0}}function Ee(){var e;return!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[P]),d(e)&&(e=Me()),!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var w=r.get(c),_=!1;if(d(w)){if(!l)return;w=new x,r.set(c,w),_=!0}var v=w.get(f);if(d(v)){if(!l)return;if(v=new x,w.set(f,v),!e.setProvider(c,f,i))throw w.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return v}function h(c,f,l){var w=s(f,l,!1);return d(w)?!1:oe(w.has(c))}function k(c,f,l){var w=s(f,l,!1);if(!d(w))return w.get(c)}function m(c,f,l,w){var _=s(l,w,!0);_.set(c,f)}function p(c,f){var l=[],w=s(c,f,!1);if(d(w))return l;for(var _=w.keys(),v=ce(_),M=0;;){var de=le(v);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(v)}finally{throw xe}}M++}}function u(c,f,l){var w=s(f,l,!1);if(d(w)||!w.delete(c))return!1;if(w.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new x}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=j.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?j.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?j.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(j.has(r,u));return r[u]=!0,u}function h(u,c){if(!y.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:j.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function q(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Vt}Rr();const dt=Symbol("ARTIFACTS");let Ar=class{constructor(t){ht(this,"_recognizableHooks",new Map),ht(this,"_hookDependencies",new Map),ht(this,"_installedHooks",new Map);for(const[o,{hook:a,deps:y}]of Object.entries(t))this._recognizableHooks.set(o,a),y&&this._hookDependencies.set(o,y||[])}isHookInstalled(t,o){const a=this._recognizableHooks.get(o);if(!a||!this._installedHooks.has(t))return!1;const y=this._installedHooks.get(t);return y?y.some(g=>g===a):!1}markHookAsInstalled(t,o){var a;const y=this._recognizableHooks.get(o);if(!y)throw new Error(`Hook ${o} not found`);this._installedHooks.has(t)||this._installedHooks.set(t,[]),(a=this._installedHooks.get(t))==null||a.push(y)}async installHook(t,o){const a=this._recognizableHooks.get(t);if(!a)throw new Error(`Hook ${t} not found`);if(this.isHookInstalled(o,t))return;const y=this._hookDependencies.get(t)||[];for(const S of y)await this.installHook(S,o);const g=Reflect.getMetadata(dt,o)||{};Reflect.hasMetadata(dt,o)||Reflect.defineMetadata(dt,g,o);for(const S of a){if(typeof S=="function"){await S({sdk:o,artifacts:g});continue}const O=await S.install({sdk:o,artifacts:g});!O||typeof O!="object"||Object.assign(g,O)}this.markHookAsInstalled(o,t)}async installAllHooks(t){for(const o of this._recognizableHooks.keys())await this.installHook(o,t)}};var xr=Object.defineProperty,$r=(n,t,o)=>t in n?xr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,We=(n,t,o)=>$r(n,typeof t!="symbol"?t+"":t,o),Dr=Object.defineProperty,Fr=(n,t,o)=>t in n?Dr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,rt=(n,t,o)=>Fr(n,typeof t!="symbol"?t+"":t,o),zt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kt={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var Wt;function Vr(){if(Wt)return Kt;Wt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof zt=="object"?zt:typeof self=="object"?self:typeof this=="object"?this:T(),y=g(t);typeof a.Reflect<"u"&&(y=g(a.Reflect,y)),o(y,a),typeof a.Reflect>"u"&&(a.Reflect=t);function g($,I){return function(j,A){Object.defineProperty($,j,{configurable:!0,writable:!0,value:A}),I&&I(j,A)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function T(){return S()||O()}})(function(o,a){var y=Object.prototype.hasOwnProperty,g=typeof Symbol=="function",S=g&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=g&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",$={__proto__:[]}instanceof Array,I=!T&&!$,j={create:T?function(){return q(Object.create(null))}:$?function(){return q({__proto__:null})}:function(){return q({})},has:I?function(e,r){return y.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return y.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},A=Object.getPrototypeOf(Function),x=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),P=g?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ge(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!R(s))throw new TypeError;return R(s)&&(s=void 0),i=E(i),ve(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=E(s)),te(e,r,i,s)}o("defineMetadata",C);function L(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),Q(e,r,i)}o("hasMetadata",L);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=E(i)),!b(r))throw new TypeError;d(i)||(i=E(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ge(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!R(h)){if(!se(h))throw new TypeError;r=h}}return r}function ve(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!R(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return R(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!R(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,w=h;l<w.length;l++){var c=w[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function R(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function E(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===A||r!==A)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(P)&&typeof a.Reflect<"u"&&!(P in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,w){if(!d(r)){if(r.isProviderFor(l,w))return r;if(!d(i)){if(i.isProviderFor(l,w))return r;if(!d(s))for(var _=ce(s);;){var v=le(_);if(!v)return;var M=fe(v);if(M.isProviderFor(l,w))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,w))return e}function u(l,w){var _=h.get(l),v;return d(_)||(v=_.get(w)),d(v)&&(v=p(l,w),d(v)||(d(_)&&(_=new x,h.set(l,_)),_.set(w,v))),v}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,w,_){if(!c(_))throw new Error("Metadata provider not registered.");var v=u(l,w);if(v!==_){if(!d(v))return!1;var M=h.get(l);d(M)&&(M=new x,h.set(l,M)),M.set(w,_)}return!0}}function Ee(){var e;return!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[P]),d(e)&&(e=Me()),!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var w=r.get(c),_=!1;if(d(w)){if(!l)return;w=new x,r.set(c,w),_=!0}var v=w.get(f);if(d(v)){if(!l)return;if(v=new x,w.set(f,v),!e.setProvider(c,f,i))throw w.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return v}function h(c,f,l){var w=s(f,l,!1);return d(w)?!1:oe(w.has(c))}function k(c,f,l){var w=s(f,l,!1);if(!d(w))return w.get(c)}function m(c,f,l,w){var _=s(l,w,!0);_.set(c,f)}function p(c,f){var l=[],w=s(c,f,!1);if(d(w))return l;for(var _=w.keys(),v=ce(_),M=0;;){var de=le(v);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(v)}finally{throw xe}}M++}}function u(c,f,l){var w=s(f,l,!1);if(d(w)||!w.delete(c))return!1;if(w.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new x}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=j.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?j.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?j.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(j.has(r,u));return r[u]=!0,u}function h(u,c){if(!y.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:j.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function q(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Kt}Vr();var Cr=Object.defineProperty,zr=(n,t,o)=>t in n?Cr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ne=(n,t,o)=>zr(n,typeof t!="symbol"?t+"":t,o);let Kr=class{constructor(t,o){Ne(this,"_target"),Ne(this,"_key"),Ne(this,"_oldValue"),Ne(this,"_wasDefined",!1),Ne(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const Wr={onlyIfNotExists:!0,isFactory:!1};class nt{constructor(t,o,a={}){if(rt(this,"_installedInstances",new Map),rt(this,"_path"),rt(this,"_targetValue"),rt(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...Wr,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new Kr(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const y=this._targetValue({sdk:t,...o});a.swap(y)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}}function Nt(){return"unsafeWindow"in window?window.unsafeWindow:window}var Nr=Object.defineProperty,Hr=(n,t,o)=>t in n?Nr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,$e=(n,t,o)=>Hr(n,typeof t!="symbol"?t+"":t,o);class Ur{constructor(t,o){$e(this,"_target"),$e(this,"_key"),$e(this,"_oldValue"),$e(this,"_wasDefined",!1),$e(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}let pt=class{constructor(t,o,a){$e(this,"_enabled",!1),$e(this,"_fnSwapper"),$e(this,"_interceptionFunction"),$e(this,"_middlewares",[]),this._fnSwapper=new Ur(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}};function qr(n,t){try{return n()}catch{return t}}let Lr=class extends pt{constructor(t,o,a){super(t,o,a),$e(this,"_loggedInvocationRequests",[]),this.registerMiddleware((...y)=>this.logRequest(...y))}logRequest(...t){this._loggedInvocationRequests.push(t)}flushLoggedRequests(){const t=this.getLoggedRequests();return this._loggedInvocationRequests=[],t}getLoggedRequests(){return this._loggedInvocationRequests}executeOriginalLoggedRequests(){this.flushLoggedRequests().forEach(t=>qr(()=>this.callOriginalInvocator(...t)))}};class Gr{constructor(){We(this,"_hasResult",!1),We(this,"result")}store(t){return this.result=t,this._hasResult=!0,t}clear(){this.result=void 0,this._hasResult=!1}getResult(){if(!this.hasResult)throw new Error("No result is stored");return this.result}get hasResult(){return this._hasResult}}function Br(n){const t=new Gr;new pt(n,"doAction",(o,...a)=>t.hasResult?t.getResult():t.store(o(...a))).enable(),new pt(n,"undoAction",(o,...a)=>{const y=o(...a);return t.clear(),y}).enable()}let Jr=class{constructor(){We(this,"actions",[]),We(this,"undoableActions",[])}acceptAction(t,o){const a={action:t,dataModel:o};t.undoSupported()&&(Br(t),t.doAction(o),this.undoableActions.push(a)),this.actions.push(a)}undoAll(){this.undoableActions.forEach(({action:t,dataModel:o})=>t.undoAction(o))}getActions(){return this.actions.map(({action:t})=>t)}};function Zr(){try{return Nt().require("Waze/Action/MultiAction")}catch{return null}}function Yr(n){const t=Zr();if(!t)throw new Error("Unable to retrieve MultiAction");return new t(n)}let Qr=class{constructor(t){We(this,"_activeTransaction",null),We(this,"_actionManagerAddInterceptor"),this._actionManagerAddInterceptor=new Lr(t,"add",(o,a)=>{var y,g;return(g=(y=this._activeTransaction)==null?void 0:y.acceptAction)==null||g.call(y,a,t.dataModel),!0})}openTransaction(){this._activeTransaction=new Jr,this._actionManagerAddInterceptor.enable()}closeTransaction(){const t=this._activeTransaction;return this._activeTransaction=null,this._actionManagerAddInterceptor.flushLoggedRequests(),this._actionManagerAddInterceptor.disable(),t}get hasTransaction(){return this._activeTransaction!==null}beginTransaction(){this.openTransaction()}commitTransaction(t){if(!this.hasTransaction)throw new Error("No open transaction found");try{const o=this._activeTransaction.getActions(),a=Yr(o);t&&(a._description=t),this._actionManagerAddInterceptor.callOriginalInvocator(a)}catch{this._actionManagerAddInterceptor.executeOriginalLoggedRequests()}finally{this.closeTransaction()}}cancelTransaction(){var t;(t=this._activeTransaction)==null||t.undoAll(),this.closeTransaction()}},yt;function it(){if(!yt){const n=Nt();yt=new Qr(n.W.model.actionManager)}return yt}const Xr=[new nt("Editing.beginTransaction",()=>it().beginTransaction()),new nt("Editing.commitTransaction",n=>it().commitTransaction(n)),new nt("Editing.cancelTransaction",()=>it().cancelTransaction()),new nt("Editing.doActions",(n,t)=>{const o=it();o.beginTransaction();try{n(),o.commitTransaction(t)}catch(a){throw o.cancelTransaction(),a}})];var en=Object.defineProperty,tn=(n,t,o)=>t in n?en(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ot=(n,t,o)=>tn(n,typeof t!="symbol"?t+"":t,o),Ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ut={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var qt;function rn(){if(qt)return Ut;qt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Ht=="object"?Ht:typeof self=="object"?self:typeof this=="object"?this:T(),y=g(t);typeof a.Reflect<"u"&&(y=g(a.Reflect,y)),o(y,a),typeof a.Reflect>"u"&&(a.Reflect=t);function g($,I){return function(j,A){Object.defineProperty($,j,{configurable:!0,writable:!0,value:A}),I&&I(j,A)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function T(){return S()||O()}})(function(o,a){var y=Object.prototype.hasOwnProperty,g=typeof Symbol=="function",S=g&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=g&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",$={__proto__:[]}instanceof Array,I=!T&&!$,j={create:T?function(){return q(Object.create(null))}:$?function(){return q({__proto__:null})}:function(){return q({})},has:I?function(e,r){return y.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return y.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},A=Object.getPrototypeOf(Function),x=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),P=g?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ge(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!R(s))throw new TypeError;return R(s)&&(s=void 0),i=E(i),ve(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=E(s)),te(e,r,i,s)}o("defineMetadata",C);function L(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),Q(e,r,i)}o("hasMetadata",L);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=E(i)),!b(r))throw new TypeError;d(i)||(i=E(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ge(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!R(h)){if(!se(h))throw new TypeError;r=h}}return r}function ve(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!R(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return R(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!R(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,w=h;l<w.length;l++){var c=w[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function R(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function E(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===A||r!==A)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(P)&&typeof a.Reflect<"u"&&!(P in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,w){if(!d(r)){if(r.isProviderFor(l,w))return r;if(!d(i)){if(i.isProviderFor(l,w))return r;if(!d(s))for(var _=ce(s);;){var v=le(_);if(!v)return;var M=fe(v);if(M.isProviderFor(l,w))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,w))return e}function u(l,w){var _=h.get(l),v;return d(_)||(v=_.get(w)),d(v)&&(v=p(l,w),d(v)||(d(_)&&(_=new x,h.set(l,_)),_.set(w,v))),v}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,w,_){if(!c(_))throw new Error("Metadata provider not registered.");var v=u(l,w);if(v!==_){if(!d(v))return!1;var M=h.get(l);d(M)&&(M=new x,h.set(l,M)),M.set(w,_)}return!0}}function Ee(){var e;return!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[P]),d(e)&&(e=Me()),!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var w=r.get(c),_=!1;if(d(w)){if(!l)return;w=new x,r.set(c,w),_=!0}var v=w.get(f);if(d(v)){if(!l)return;if(v=new x,w.set(f,v),!e.setProvider(c,f,i))throw w.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return v}function h(c,f,l){var w=s(f,l,!1);return d(w)?!1:oe(w.has(c))}function k(c,f,l){var w=s(f,l,!1);if(!d(w))return w.get(c)}function m(c,f,l,w){var _=s(l,w,!0);_.set(c,f)}function p(c,f){var l=[],w=s(c,f,!1);if(d(w))return l;for(var _=w.keys(),v=ce(_),M=0;;){var de=le(v);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(v)}finally{throw xe}}M++}}function u(c,f,l){var w=s(f,l,!1);if(d(w)||!w.delete(c))return!1;if(w.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new x}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=j.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?j.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?j.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(j.has(r,u));return r[u]=!0,u}function h(u,c){if(!y.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:j.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function q(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Ut}rn();var nn=Object.defineProperty,on=(n,t,o)=>t in n?nn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,He=(n,t,o)=>on(n,typeof t!="symbol"?t+"":t,o);let an=class{constructor(t,o){He(this,"_target"),He(this,"_key"),He(this,"_oldValue"),He(this,"_wasDefined",!1),He(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const sn={onlyIfNotExists:!0,isFactory:!1};let Lt=class{constructor(t,o,a={}){if(ot(this,"_installedInstances",new Map),ot(this,"_path"),ot(this,"_targetValue"),ot(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...sn,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new an(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const y=this._targetValue({sdk:t,...o});a.swap(y)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}};var un=Object.defineProperty,cn=(n,t,o)=>t in n?un(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ue=(n,t,o)=>cn(n,typeof t!="symbol"?t+"":t,o);let fn=class{constructor(t,o){Ue(this,"_target"),Ue(this,"_key"),Ue(this,"_oldValue"),Ue(this,"_wasDefined",!1),Ue(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};function wt(){return"unsafeWindow"in window?window.unsafeWindow:window}var ln=Object.defineProperty,hn=(n,t,o)=>t in n?ln(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Gt=(n,t,o)=>hn(n,typeof t!="symbol"?t+"":t,o);function qe(){return"unsafeWindow"in window?window.unsafeWindow:window}var dn=Object.defineProperty,pn=(n,t,o)=>t in n?dn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,De=(n,t,o)=>pn(n,typeof t!="symbol"?t+"":t,o);let yn=class{constructor(t,o){De(this,"_target"),De(this,"_key"),De(this,"_oldValue"),De(this,"_wasDefined",!1),De(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},wn=class{constructor(t,o,a){De(this,"_enabled",!1),De(this,"_fnSwapper"),De(this,"_interceptionFunction"),De(this,"_middlewares",[]),this._fnSwapper=new yn(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},_n=class{constructor(t){Gt(this,"_fetchInterceptor"),Gt(this,"_interceptionFilters",new Set),this._fetchInterceptor=new wn(t,"fetch",(o,a,y)=>{for(const g of this._interceptionFilters)if(g.shouldIntercept(a,y))return this.shouldKeepFilter(g,a,y)||this.removeInterceptionFilter(g),g.intercept(a,y);return o(a,y)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};function gn(n){return n=n instanceof URL?n:new URL(n,qe().location.href),t=>typeof t=="string"?new URL(t,qe().location.href).pathname===n.pathname:t instanceof URL?t.pathname===n.pathname:new URL(t.url,qe().location.href).pathname===new URL(n,qe().location.href).pathname}function vn(n,t,o){const a=new Response(t,o),y=new URL(n,location.toString());return Object.defineProperty(a,"url",{value:y}),a}function bn(n,t){const o=JSON.stringify(t),a=new Headers({"Content-Type":"application/json"});return vn(n,o,{headers:a})}const mn=new _n(qe());function kn(n){return!("descartesHttpClient"in n)&&"createAbortController"in n&&typeof n.createAbortController=="function"}function On(){const n=wt().W.controller.descartesClient,t=kn(n)?n:n.descartesHttpClient,o=new fn(t,"createAbortController");o.swap(()=>(o.restore(),new AbortController))}function Sn(n){const t=wt();return On(),t.W.controller.descartesClient.getFeatures([0,0,0,0],{[n]:!0},{})}async function Mn(n,t){const o=wt().W.Config.paths.features;mn.addInterceptionFilter({shouldIntercept:gn(o),intercept(){return Promise.resolve(bn(o,{[n]:{objects:[t]}}))}});const{[n]:a}=await Sn(n),[y]=a.objects;return y.constructor}function En(n,t,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties={},a.geometry=n,a}function jn(n,t,o={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Bt(n[0])||!Bt(n[1]))throw new Error("coordinates must contain numbers");return En({type:"Point",coordinates:n},t,o)}function Bt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Le(){return"unsafeWindow"in window?window.unsafeWindow:window}function Tn(n){const t=Le().require("Waze/Action/CreateObject");return new t(n)}function In(n){Le().W.model.actionManager.add(Tn(n))}function Pn(n){return n.toISOString().slice(0,16).replace("T"," ")}function Rn(n){return Le().W.model.mapComments.getObjectById(n)}function An(n,t){const o=Le().require("Waze/Action/UpdateObject");return new o(n,t)}function xn(n,t){Le().W.model.actionManager.add(An(n,t))}let _t;function $n(){if(!_t)throw new Error("MapComment not initialized. Make sure to await the enhancedSDK function before using it.")}const Dn=[{async install(){_t=await Mn("mapComments",{geometry:jn([0,0]).geometry})}},new Lt("DataModel.MapComments.addMapComment",n=>{$n();const t=new _t({geoJSONGeometry:n.geometry,subject:n.subject,body:n.body,lockRank:n.lockRank,endDate:n.endDate?Pn(n.endDate):null});return In(t),t.getID()}),new Lt("DataModel.MapComments.updateMapComment",({sdkInstance:n})=>t=>{const o=Rn(t.mapCommentId);if(!o)throw new n.Errors.DataModelNotFoundError("mapComment",t.mapCommentId);const a={};t.geometry&&(a.geoJSONGeometry=t.geometry),t.subject&&(a.subject=t.subject),t.body&&(a.body=t.body),t.lockRank&&(a.lockRank=t.lockRank),xn(o,a)},{isFactory:!0})];var Fn=Object.defineProperty,Vn=(n,t,o)=>t in n?Fn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,at=(n,t,o)=>Vn(n,typeof t!="symbol"?t+"":t,o),Jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Zt={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var Yt;function Cn(){if(Yt)return Zt;Yt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Jt=="object"?Jt:typeof self=="object"?self:typeof this=="object"?this:T(),y=g(t);typeof a.Reflect<"u"&&(y=g(a.Reflect,y)),o(y,a),typeof a.Reflect>"u"&&(a.Reflect=t);function g($,I){return function(j,A){Object.defineProperty($,j,{configurable:!0,writable:!0,value:A}),I&&I(j,A)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function T(){return S()||O()}})(function(o,a){var y=Object.prototype.hasOwnProperty,g=typeof Symbol=="function",S=g&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=g&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",$={__proto__:[]}instanceof Array,I=!T&&!$,j={create:T?function(){return q(Object.create(null))}:$?function(){return q({__proto__:null})}:function(){return q({})},has:I?function(e,r){return y.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return y.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},A=Object.getPrototypeOf(Function),x=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),P=g?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ge(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!R(s))throw new TypeError;return R(s)&&(s=void 0),i=E(i),ve(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=E(s)),te(e,r,i,s)}o("defineMetadata",C);function L(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),Q(e,r,i)}o("hasMetadata",L);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=E(i)),!b(r))throw new TypeError;d(i)||(i=E(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ge(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!R(h)){if(!se(h))throw new TypeError;r=h}}return r}function ve(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!R(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return R(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!R(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,w=h;l<w.length;l++){var c=w[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function R(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function E(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===A||r!==A)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(P)&&typeof a.Reflect<"u"&&!(P in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,w){if(!d(r)){if(r.isProviderFor(l,w))return r;if(!d(i)){if(i.isProviderFor(l,w))return r;if(!d(s))for(var _=ce(s);;){var v=le(_);if(!v)return;var M=fe(v);if(M.isProviderFor(l,w))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,w))return e}function u(l,w){var _=h.get(l),v;return d(_)||(v=_.get(w)),d(v)&&(v=p(l,w),d(v)||(d(_)&&(_=new x,h.set(l,_)),_.set(w,v))),v}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,w,_){if(!c(_))throw new Error("Metadata provider not registered.");var v=u(l,w);if(v!==_){if(!d(v))return!1;var M=h.get(l);d(M)&&(M=new x,h.set(l,M)),M.set(w,_)}return!0}}function Ee(){var e;return!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[P]),d(e)&&(e=Me()),!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var w=r.get(c),_=!1;if(d(w)){if(!l)return;w=new x,r.set(c,w),_=!0}var v=w.get(f);if(d(v)){if(!l)return;if(v=new x,w.set(f,v),!e.setProvider(c,f,i))throw w.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return v}function h(c,f,l){var w=s(f,l,!1);return d(w)?!1:oe(w.has(c))}function k(c,f,l){var w=s(f,l,!1);if(!d(w))return w.get(c)}function m(c,f,l,w){var _=s(l,w,!0);_.set(c,f)}function p(c,f){var l=[],w=s(c,f,!1);if(d(w))return l;for(var _=w.keys(),v=ce(_),M=0;;){var de=le(v);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(v)}finally{throw xe}}M++}}function u(c,f,l){var w=s(f,l,!1);if(d(w)||!w.delete(c))return!1;if(w.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new x}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=j.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?j.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?j.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(j.has(r,u));return r[u]=!0,u}function h(u,c){if(!y.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:j.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function q(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Zt}Cn();var zn=Object.defineProperty,Kn=(n,t,o)=>t in n?zn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ge=(n,t,o)=>Kn(n,typeof t!="symbol"?t+"":t,o);let Wn=class{constructor(t,o){Ge(this,"_target"),Ge(this,"_key"),Ge(this,"_oldValue"),Ge(this,"_wasDefined",!1),Ge(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const Nn={onlyIfNotExists:!0,isFactory:!1};class gt{constructor(t,o,a={}){if(at(this,"_installedInstances",new Map),at(this,"_path"),at(this,"_targetValue"),at(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...Nn,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new Wn(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const y=this._targetValue({sdk:t,...o});a.swap(y)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}}var Hn=Object.defineProperty,Un=(n,t,o)=>t in n?Hn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Be=(n,t,o)=>Un(n,typeof t!="symbol"?t+"":t,o);let Qt=class{constructor(n,t){Be(this,"_target"),Be(this,"_key"),Be(this,"_oldValue"),Be(this,"_wasDefined",!1),Be(this,"_isSwapped",!1),this._target=n,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(n){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=n,this._isSwapped=!0}};function vt(){return"unsafeWindow"in window?window.unsafeWindow:window}async function qn(n){const t=[],o=new Qt(vt().W.model.actionManager,"add");o.swap(a=>{t.push(a)});try{await n()}finally{o.restore()}return t}function Ln(n){return n.memoizedProps||{}}function Gn(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&Array.isArray(n.memoizedState)&&n.memoizedState.length===2&&"queue"in n&&n.queue===null&&Array.isArray(n.memoizedState[1])}function Bn(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&typeof n.memoizedState=="object"&&n.memoizedState!==null&&"current"in n.memoizedState&&"queue"in n&&n.queue===null}function Jn(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&"queue"in n&&typeof n.queue=="object"&&n.queue!==null&&"dispatch"in n.queue&&typeof n.queue.dispatch=="function"}function Zn(n){return Jn(n)?{type:"useState",value:n.memoizedState,dispatch:n.queue.dispatch}:Gn(n)?{type:"useMemo",value:n.memoizedState[0],dependencies:n.memoizedState[1]}:Bn(n)?{type:"useRef",current:n.memoizedState}:null}function Yn(n,t){const o=[];let a=n.memoizedState;for(;a;){const y=Zn(a);y&&o.push(y),a=a.next}return o}function Qn(n,t,o=1/0){let a=n,y=0;for(;a&&y<o;){const g=a.memoizedState?Yn(a):[],S=Ln(a),O={fiber:a,hooks:{all:g,useState:g.filter(T=>T.type==="useState"),useMemo:g.filter(T=>T.type==="useMemo"),useRef:g.filter(T=>T.type==="useRef")},props:S};if(t(O))return O;a=a.return,y++}return null}const Xn="__reactFiber$";function ei(n){const t=Object.keys(n).find(a=>a.startsWith(Xn));if(!t)throw new Error(`No fiber key found for element: ${n}`);const o=n[t];if(!o)throw new Error(`No fiber found for element: ${n}`);return o}const ti=n=>new Promise(t=>{const o=vt(),a=new Qt(o.W.map.olMap,"addControl");a.swap(y=>{n==null||n(y),t(y),a.restore()})});function ri(n){const t=vt(),o=t.W.userscripts.toOLGeometry(n);return new t.OpenLayers.Feature.Vector(o)}async function ni(n,t){const o=Qn(ei(n),g=>"onClick"in g.props&&typeof g.props.onClick=="function");if(!o)throw new Error("No fiber found with draw initiator");const{onClick:a}=o.props;//! OpenLayers dependent code below - implementation might change over time
const y=ti(g=>{g.activate=()=>{}});a(new Event("click")),(await y).events.triggerEvent("featureadded",{feature:ri(t)})}var ii=Object.defineProperty,oi=(n,t,o)=>t in n?ii(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Xt=(n,t,o)=>oi(n,typeof t!="symbol"?t+"":t,o);function ai(){return"unsafeWindow"in window?window.unsafeWindow:window}var si=Object.defineProperty,ui=(n,t,o)=>t in n?si(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Fe=(n,t,o)=>ui(n,typeof t!="symbol"?t+"":t,o);let ci=class{constructor(t,o){Fe(this,"_target"),Fe(this,"_key"),Fe(this,"_oldValue"),Fe(this,"_wasDefined",!1),Fe(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},fi=class{constructor(t,o,a){Fe(this,"_enabled",!1),Fe(this,"_fnSwapper"),Fe(this,"_interceptionFunction"),Fe(this,"_middlewares",[]),this._fnSwapper=new ci(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},li=class{constructor(t){Xt(this,"_fetchInterceptor"),Xt(this,"_interceptionFilters",new Set),this._fetchInterceptor=new fi(t,"fetch",(o,a,y)=>{for(const g of this._interceptionFilters)if(g.shouldIntercept(a,y))return this.shouldKeepFilter(g,a,y)||this.removeInterceptionFilter(g),g.intercept(a,y);return o(a,y)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};new li(ai());function hi(n,t,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties={},a.geometry=n,a}function di(n,t,o={}){for(const a of n){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let y=0;y<a[a.length-1].length;y++)if(a[a.length-1][y]!==a[0][y])throw new Error("First and last Position are not equivalent.")}return hi({type:"Polygon",coordinates:n},t,o)}function st(){return"unsafeWindow"in window?window.unsafeWindow:window}function pi(n,t,o){const a=new n(o),y=new t(a);return st().W.model.actionManager.add(y),a}function er(n){return st().W.model.permanentHazards.getObjectById(n)}function yi(n,t){const o=st().require("Waze/Action/UpdateObject");return new o(n,t)}function wi(n,t){st().W.model.actionManager.add(yi(n,t))}function _i(n){return Object.fromEntries(Object.entries(n).filter(([,t])=>t!==void 0))}let bt,mt;const gi=[{async install(){const n=document.querySelector("#drawer wz-menu > wz-menu-sub-menu:nth-child(3) > wz-menu-item:nth-of-type(2)");if(!n||!(n instanceof HTMLElement))throw new Error("Unable to find school zone drawing menu item");const[t]=await qn(async()=>{await ni(n,di([[[0,0],[0,1],[1,1],[0,0]]]).geometry)});if(t.actionName!=="ADD_PERMANENT_HAZARD")throw new Error("Unexpected action discovered when tried to resolve AddPermanentHazard action: "+t.actionName);const o=t.object;if(!o)throw new Error("Unexpected state: Added object does not exist");if(o.type!=="permanentHazard")throw new Error("Unexpected state: Expected the added object to be a PermanentHazard instead of "+t.type);bt=t.constructor,mt=o.constructor}},new gt("DataModel.PermanentHazards.addSchoolZone",n=>{if(!mt||!bt)throw new Error("PermanentHazard or AddPermanentHazard are not initialized. Make sure to await the enhancedSDK function before using it.");return pi(mt,bt,{type:9,geoJSONGeometry:n.geometry,name:n.name,speedLimit:n.speedLimit,excludedRoadTypes:n.excludedRoadTypes}).getID()}),new gt("DataModel.PermanentHazards.updateSchoolZone",({sdkInstance:n})=>t=>{const o=er(t.schoolZoneId);if(!o||o.getAttribute("type")!==9)throw new n.Errors.DataModelNotFoundError("permanentHazard.SchoolZone",t.schoolZoneId);wi(o,_i({geoJSONGeometry:t.geometry,name:t.name,speedLimit:t.speedLimit,excludedRoadTypes:t.excludedRoadTypes}))},{isFactory:!0}),new gt("DataModel.PermanentHazards.getSchoolZoneById",()=>n=>{const t=er(n.schoolZoneId);return!t||t.getAttribute("type")!==9?null:t},{isFactory:!0})];var vi=Object.defineProperty,bi=(n,t,o)=>t in n?vi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ut=(n,t,o)=>bi(n,typeof t!="symbol"?t+"":t,o),tr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rr={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var nr;function mi(){if(nr)return rr;nr=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof tr=="object"?tr:typeof self=="object"?self:typeof this=="object"?this:T(),y=g(t);typeof a.Reflect<"u"&&(y=g(a.Reflect,y)),o(y,a),typeof a.Reflect>"u"&&(a.Reflect=t);function g($,I){return function(j,A){Object.defineProperty($,j,{configurable:!0,writable:!0,value:A}),I&&I(j,A)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function T(){return S()||O()}})(function(o,a){var y=Object.prototype.hasOwnProperty,g=typeof Symbol=="function",S=g&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=g&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",$={__proto__:[]}instanceof Array,I=!T&&!$,j={create:T?function(){return q(Object.create(null))}:$?function(){return q({__proto__:null})}:function(){return q({})},has:I?function(e,r){return y.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return y.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},A=Object.getPrototypeOf(Function),x=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),P=g?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ge(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!R(s))throw new TypeError;return R(s)&&(s=void 0),i=E(i),ve(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=E(s)),te(e,r,i,s)}o("defineMetadata",C);function L(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),Q(e,r,i)}o("hasMetadata",L);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=E(i)),!b(r))throw new TypeError;d(i)||(i=E(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ge(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!R(h)){if(!se(h))throw new TypeError;r=h}}return r}function ve(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!R(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return R(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!R(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,w=h;l<w.length;l++){var c=w[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function R(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function E(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===A||r!==A)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(P)&&typeof a.Reflect<"u"&&!(P in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,w){if(!d(r)){if(r.isProviderFor(l,w))return r;if(!d(i)){if(i.isProviderFor(l,w))return r;if(!d(s))for(var _=ce(s);;){var v=le(_);if(!v)return;var M=fe(v);if(M.isProviderFor(l,w))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,w))return e}function u(l,w){var _=h.get(l),v;return d(_)||(v=_.get(w)),d(v)&&(v=p(l,w),d(v)||(d(_)&&(_=new x,h.set(l,_)),_.set(w,v))),v}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,w,_){if(!c(_))throw new Error("Metadata provider not registered.");var v=u(l,w);if(v!==_){if(!d(v))return!1;var M=h.get(l);d(M)&&(M=new x,h.set(l,M)),M.set(w,_)}return!0}}function Ee(){var e;return!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[P]),d(e)&&(e=Me()),!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var w=r.get(c),_=!1;if(d(w)){if(!l)return;w=new x,r.set(c,w),_=!0}var v=w.get(f);if(d(v)){if(!l)return;if(v=new x,w.set(f,v),!e.setProvider(c,f,i))throw w.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return v}function h(c,f,l){var w=s(f,l,!1);return d(w)?!1:oe(w.has(c))}function k(c,f,l){var w=s(f,l,!1);if(!d(w))return w.get(c)}function m(c,f,l,w){var _=s(l,w,!0);_.set(c,f)}function p(c,f){var l=[],w=s(c,f,!1);if(d(w))return l;for(var _=w.keys(),v=ce(_),M=0;;){var de=le(v);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(v)}finally{throw xe}}M++}}function u(c,f,l){var w=s(f,l,!1);if(d(w)||!w.delete(c))return!1;if(w.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new x}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=j.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?j.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?j.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(j.has(r,u));return r[u]=!0,u}function h(u,c){if(!y.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:j.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function q(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),rr}mi();var ki=Object.defineProperty,Oi=(n,t,o)=>t in n?ki(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Je=(n,t,o)=>Oi(n,typeof t!="symbol"?t+"":t,o);let Si=class{constructor(t,o){Je(this,"_target"),Je(this,"_key"),Je(this,"_oldValue"),Je(this,"_wasDefined",!1),Je(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const Mi={onlyIfNotExists:!0,isFactory:!1};let Ei=class{constructor(t,o,a={}){if(ut(this,"_installedInstances",new Map),ut(this,"_path"),ut(this,"_targetValue"),ut(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...Mi,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new Si(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const y=this._targetValue({sdk:t,...o});a.swap(y)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}};const ir=Symbol("BigJunction"),or=Symbol("AddBigJunction");function ji(){return"unsafeWindow"in window?window.unsafeWindow:window}function Ti(n,t,o){const a=new n(o),y=new t(a);return ji().W.model.actionManager.add(y),a}const Ii=[new Ei("DataModel.BigJunctions.addBigJunction",({artifacts:n})=>t=>Ti(n[ir],n[or],{geoJSONGeometry:t.geometry}).getID(),{isFactory:!0})];function Pi(n,t,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties={},a.geometry=n,a}function Ri(n,t,o={}){for(const a of n){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let y=0;y<a[a.length-1].length;y++)if(a[a.length-1][y]!==a[0][y])throw new Error("First and last Position are not equivalent.")}return Pi({type:"Polygon",coordinates:n},t,o)}var Ai=Object.defineProperty,xi=(n,t,o)=>t in n?Ai(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ze=(n,t,o)=>xi(n,typeof t!="symbol"?t+"":t,o);let ar=class{constructor(t,o){Ze(this,"_target"),Ze(this,"_key"),Ze(this,"_oldValue"),Ze(this,"_wasDefined",!1),Ze(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};function kt(){return"unsafeWindow"in window?window.unsafeWindow:window}async function $i(n){const t=[],o=new ar(kt().W.model.actionManager,"add");o.swap(a=>{t.push(a)});try{await n()}finally{o.restore()}return t}function Di(n){return n.memoizedProps||{}}function Fi(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&Array.isArray(n.memoizedState)&&n.memoizedState.length===2&&"queue"in n&&n.queue===null&&Array.isArray(n.memoizedState[1])}function Vi(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&typeof n.memoizedState=="object"&&n.memoizedState!==null&&"current"in n.memoizedState&&"queue"in n&&n.queue===null}function Ci(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&"queue"in n&&typeof n.queue=="object"&&n.queue!==null&&"dispatch"in n.queue&&typeof n.queue.dispatch=="function"}function zi(n){return Ci(n)?{type:"useState",value:n.memoizedState,dispatch:n.queue.dispatch}:Fi(n)?{type:"useMemo",value:n.memoizedState[0],dependencies:n.memoizedState[1]}:Vi(n)?{type:"useRef",current:n.memoizedState}:null}function Ki(n,t){const o=[];let a=n.memoizedState;for(;a;){const y=zi(a);y&&o.push(y),a=a.next}return o}function Wi(n,t,o=1/0){let a=n,y=0;for(;a&&y<o;){const g=a.memoizedState?Ki(a):[],S=Di(a),O={fiber:a,hooks:{all:g,useState:g.filter(T=>T.type==="useState"),useMemo:g.filter(T=>T.type==="useMemo"),useRef:g.filter(T=>T.type==="useRef")},props:S};if(t(O))return O;a=a.return,y++}return null}const Ni="__reactFiber$";function Hi(n){const t=Object.keys(n).find(a=>a.startsWith(Ni));if(!t)throw new Error(`No fiber key found for element: ${n}`);const o=n[t];if(!o)throw new Error(`No fiber found for element: ${n}`);return o}const Ui=n=>new Promise(t=>{const o=kt(),a=new ar(o.W.map.olMap,"addControl");a.swap(y=>{n==null||n(y),t(y),a.restore()})});function qi(n){const t=kt(),o=t.W.userscripts.toOLGeometry(n);return new t.OpenLayers.Feature.Vector(o)}async function Li(n,t){const o=Wi(Hi(n),g=>"onClick"in g.props&&typeof g.props.onClick=="function");if(!o)throw new Error("No fiber found with draw initiator");const{onClick:a}=o.props;//! OpenLayers dependent code below - implementation might change over time
const y=Ui(g=>{g.activate=()=>{}});a(new Event("click")),(await y).events.triggerEvent("featureadded",{feature:qi(t)})}var Gi=Object.defineProperty,Bi=(n,t,o)=>t in n?Gi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,sr=(n,t,o)=>Bi(n,typeof t!="symbol"?t+"":t,o);function Ji(){return"unsafeWindow"in window?window.unsafeWindow:window}var Zi=Object.defineProperty,Yi=(n,t,o)=>t in n?Zi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ve=(n,t,o)=>Yi(n,typeof t!="symbol"?t+"":t,o);let Qi=class{constructor(t,o){Ve(this,"_target"),Ve(this,"_key"),Ve(this,"_oldValue"),Ve(this,"_wasDefined",!1),Ve(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},Xi=class{constructor(t,o,a){Ve(this,"_enabled",!1),Ve(this,"_fnSwapper"),Ve(this,"_interceptionFunction"),Ve(this,"_middlewares",[]),this._fnSwapper=new Qi(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},eo=class{constructor(t){sr(this,"_fetchInterceptor"),sr(this,"_interceptionFilters",new Set),this._fetchInterceptor=new Xi(t,"fetch",(o,a,y)=>{for(const g of this._interceptionFilters)if(g.shouldIntercept(a,y))return this.shouldKeepFilter(g,a,y)||this.removeInterceptionFilter(g),g.intercept(a,y);return o(a,y)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};new eo(Ji());const to=[{async install(){const n=document.querySelector("#drawer wz-menu > wz-menu-sub-menu:nth-child(1) > wz-menu-item:nth-of-type(4)");if(!n||!(n instanceof HTMLElement))throw new Error("Unable to find school zone drawing menu item");const[t]=await $i(async()=>{await Li(n,Ri([[[0,0],[0,1],[1,1],[0,0]]]).geometry)});if(t.actionName!=="ADD_BIG_JUNCTION")throw new Error("Unexpected action discovered when tried to resolve AddBigJunction action: "+t.actionName);const o=t.bigJunction;if(!o)throw new Error("Unexpected state: Added object does not exist");if(o.type!=="bigJunction")throw new Error("Unexpected state: Expected the added object to be a BigJunction instead of "+t.type);return{[ir]:o.constructor,[or]:t.constructor}}}],ro=[...to,...Ii];var no=Object.defineProperty,io=(n,t,o)=>t in n?no(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,B=(n,t,o)=>io(n,typeof t!="symbol"?t+"":t,o),oo=Object.defineProperty,ao=(n,t,o)=>t in n?oo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ct=(n,t,o)=>ao(n,typeof t!="symbol"?t+"":t,o),ur=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},cr={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var fr;function so(){if(fr)return cr;fr=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof ur=="object"?ur:typeof self=="object"?self:typeof this=="object"?this:T(),y=g(t);typeof a.Reflect<"u"&&(y=g(a.Reflect,y)),o(y,a),typeof a.Reflect>"u"&&(a.Reflect=t);function g($,I){return function(j,A){Object.defineProperty($,j,{configurable:!0,writable:!0,value:A}),I&&I(j,A)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function T(){return S()||O()}})(function(o,a){var y=Object.prototype.hasOwnProperty,g=typeof Symbol=="function",S=g&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=g&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",$={__proto__:[]}instanceof Array,I=!T&&!$,j={create:T?function(){return q(Object.create(null))}:$?function(){return q({__proto__:null})}:function(){return q({})},has:I?function(e,r){return y.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return y.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},A=Object.getPrototypeOf(Function),x=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),P=g?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ge(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!R(s))throw new TypeError;return R(s)&&(s=void 0),i=E(i),ve(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=E(s)),te(e,r,i,s)}o("defineMetadata",C);function L(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),Q(e,r,i)}o("hasMetadata",L);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=E(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=E(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=E(i)),!b(r))throw new TypeError;d(i)||(i=E(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ge(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!R(h)){if(!se(h))throw new TypeError;r=h}}return r}function ve(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!R(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return R(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!R(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,w=h;l<w.length;l++){var c=w[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function R(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function E(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===A||r!==A)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(P)&&typeof a.Reflect<"u"&&!(P in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,w){if(!d(r)){if(r.isProviderFor(l,w))return r;if(!d(i)){if(i.isProviderFor(l,w))return r;if(!d(s))for(var _=ce(s);;){var v=le(_);if(!v)return;var M=fe(v);if(M.isProviderFor(l,w))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,w))return e}function u(l,w){var _=h.get(l),v;return d(_)||(v=_.get(w)),d(v)&&(v=p(l,w),d(v)||(d(_)&&(_=new x,h.set(l,_)),_.set(w,v))),v}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,w,_){if(!c(_))throw new Error("Metadata provider not registered.");var v=u(l,w);if(v!==_){if(!d(v))return!1;var M=h.get(l);d(M)&&(M=new x,h.set(l,M)),M.set(w,_)}return!0}}function Ee(){var e;return!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[P]),d(e)&&(e=Me()),!d(P)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,P,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var w=r.get(c),_=!1;if(d(w)){if(!l)return;w=new x,r.set(c,w),_=!0}var v=w.get(f);if(d(v)){if(!l)return;if(v=new x,w.set(f,v),!e.setProvider(c,f,i))throw w.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return v}function h(c,f,l){var w=s(f,l,!1);return d(w)?!1:oe(w.has(c))}function k(c,f,l){var w=s(f,l,!1);if(!d(w))return w.get(c)}function m(c,f,l,w){var _=s(l,w,!0);_.set(c,f)}function p(c,f){var l=[],w=s(c,f,!1);if(d(w))return l;for(var _=w.keys(),v=ce(_),M=0;;){var de=le(v);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(v)}finally{throw xe}}M++}}function u(c,f,l){var w=s(f,l,!1);if(d(w)||!w.delete(c))return!1;if(w.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new x}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=j.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?j.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?j.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(j.has(r,u));return r[u]=!0,u}function h(u,c){if(!y.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:j.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function q(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),cr}so();var uo=Object.defineProperty,co=(n,t,o)=>t in n?uo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ye=(n,t,o)=>co(n,typeof t!="symbol"?t+"":t,o);class fo{constructor(t,o){Ye(this,"_target"),Ye(this,"_key"),Ye(this,"_oldValue"),Ye(this,"_wasDefined",!1),Ye(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}const lo={onlyIfNotExists:!0,isFactory:!1};class ho{constructor(t,o,a={}){if(ct(this,"_installedInstances",new Map),ct(this,"_path"),ct(this,"_targetValue"),ct(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...lo,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new fo(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const y=this._targetValue({sdk:t,...o});a.swap(y)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}}class Ot extends Error{constructor(t){super(t),this.name="MiddlewareError"}}class po extends Ot{constructor(t){super(t),this.name="MiddlewareFlowError"}}class yo extends Ot{constructor(t="Action prevented by middleware."){super(t),this.name="MiddlewarePreventedError"}}function ft(n){if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(o=>ft(o));if(n instanceof Date)return new Date(n);const t={};for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=ft(n[o]));return t}function lr(n){Object.freeze(n);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const o=n[t];o&&typeof o=="object"&&lr(o)}return n}function wo(n){let t=!1,o=null;const a=()=>t,y=()=>t=!0;return[function(...g){return y(),o=n.apply(this,g)},a,()=>{if(!t)throw new Error("Function has not been called yet");return o}]}class _o{constructor(t,o,a,y){B(this,"actionPoint"),B(this,"data"),B(this,"originalData"),B(this,"wmeSdk"),this.data=o,Object.defineProperty(this,"actionPoint",{value:t,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"originalData",{value:a,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"wmeSdk",{value:y,writable:!1,configurable:!1,enumerable:!0})}}class go{constructor(t,o,a,y){B(this,"actionPoint"),B(this,"data"),B(this,"mutatedData"),B(this,"wmeSdk"),B(this,"handlers"),this.actionPoint=t,this.data=this.mutatedData=o,this.wmeSdk=a,this.handlers=y}getSafeImmutableData(){return lr(ft(this.data))}getSafeMutableData(){return ft(this.mutatedData)}createContext(){return new _o(this.actionPoint,this.getSafeMutableData(),this.getSafeImmutableData(),this.wmeSdk)}async run(t){let o=-1;const a=async y=>{if(y<=o)throw await new Promise(I=>setTimeout(I,1e3)),new po("next() called multiple times within the same middleware or improperly nested.");if(o=y,y>=this.handlers.length)return t(this.mutatedData);const g=this.handlers[o],S=this.createContext(),[O,T,$]=wo(()=>(this.mutatedData=S.data,a(y+1)));try{return await Promise.resolve(g(S,O)),T()?await $():(console.warn(`Middleware handler "${g.name||"anonymous"}" did not call next() and did not throw an error. This is not recommended and may cause unexpected behavior.
Ensure to always call next() or throw an error to stop the middleware chain.`),await O())}catch(I){if(I instanceof yo)return null;throw I}};return await a(0)}}class vo extends EventTarget{constructor(t){super(),B(this,"middleware",new Map),B(this,"wmeSdk"),this.wmeSdk=t}register(t,o){if(typeof o!="function")throw new Ot("Middleware handler must be a function.");const a=this.middleware.get(t)||[],y={handler:o};a.push(y),this.middleware.set(t,a),this.dispatchEvent(new CustomEvent("middlewareRegistered",{detail:{actionPoint:t}}));let g=!1;return()=>{if(g)return;const S=this.middleware.get(t);if(!S)return;const O=S.indexOf(y);O!==-1&&(S.splice(O,1),S.length===0&&this.middleware.delete(t),g=!0,this.dispatchEvent(new CustomEvent("middlewareUnregistered",{detail:{actionPoint:t}})))}}async execute(t,o,a){const y=this.middleware.get(t)||[];await new go(t,o,this.wmeSdk,y.map(g=>g.handler)).run(a)}hasListeners(t){return this.middleware.has(t)&&(this.middleware.get(t)||[]).length>0}}const St=Symbol("REGISTRY");var bo=Object.defineProperty,mo=(n,t,o)=>t in n?bo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ce=(n,t,o)=>mo(n,typeof t!="symbol"?t+"":t,o);class ko{constructor(t,o){Ce(this,"_target"),Ce(this,"_key"),Ce(this,"_oldValue"),Ce(this,"_wasDefined",!1),Ce(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}let hr=class{constructor(n,t,o){Ce(this,"_enabled",!1),Ce(this,"_fnSwapper"),Ce(this,"_interceptionFunction"),Ce(this,"_middlewares",[]),this._fnSwapper=new ko(n,t),this._interceptionFunction=o}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const n=this;this._fnSwapper.swap(function(...t){if(!n._enabled)return n.callOriginalInvocator(...t);const o=n.runMiddlewares(t);if(o){if("output"in o)return o.output;"input"in o&&(t=o.input)}return n._interceptionFunction.call(this,n.getOriginalInvocator(this),...t)})}getOriginalInvocator(n){return this._fnSwapper.originalValue.bind(n??this._fnSwapper.target)}callOriginalInvocator(...n){return this.getOriginalInvocator()(...n)}runMiddlewares(n){for(const t of this._middlewares){const o=t(...n);if(o){if("output"in o)return o;"input"in o&&(n=o.input)}}return{input:n}}registerMiddleware(n){this._middlewares.push(n)}};function Qe(){return"unsafeWindow"in window?window.unsafeWindow:window}class dr{constructor(t){B(this,"isMiddlewareDefined",!1),B(this,"uninstaller",null),B(this,"registry"),B(this,"artifacts"),B(this,"handleMiddlewareRegistered",o=>{o.detail.actionPoint===this.options.actionPoint&&this.defineMiddleware(this.artifacts)}),B(this,"handleMiddlewareUnregistered",o=>{var a;o.detail.actionPoint===this.options.actionPoint&&((a=this.registry)!=null&&a.hasListeners(this.options.actionPoint)||this.undefineMiddleware())}),this.options=t}addRegistryEvents(){var t,o;(t=this.registry)==null||t.addEventListener("middlewareRegistered",this.handleMiddlewareRegistered),(o=this.registry)==null||o.addEventListener("middlewareUnregistered",this.handleMiddlewareUnregistered)}removeRegistryEvents(){var t,o;(t=this.registry)==null||t.removeEventListener("middlewareRegistered",this.handleMiddlewareRegistered),(o=this.registry)==null||o.removeEventListener("middlewareUnregistered",this.handleMiddlewareUnregistered)}defineMiddleware(t){this.isMiddlewareDefined||(this.uninstaller=this.options.install(o=>new Promise(a=>{if(!this.registry)return a(o);this.registry.execute(this.options.actionPoint,o,a)}),t)||null,this.isMiddlewareDefined=!0)}undefineMiddleware(){var t;this.isMiddlewareDefined&&((t=this.uninstaller)==null||t.call(this),this.isMiddlewareDefined=!1)}install({artifacts:t}){var o;this.artifacts=t,this.registry=t[this.options.registryArtifactName??St],(o=this.registry)!=null&&o.hasListeners(this.options.actionPoint)&&this.defineMiddleware(t),this.addRegistryEvents()}uninstall(){this.removeRegistryEvents(),this.undefineMiddleware(),this.registry=void 0}}function Oo(){return new Promise(n=>{const t="problems:shown",o=Qe(),a=async y=>{if(y.type!=="mapUpdateRequest")return;o.W.app.off(t,a);const g=await o.W.problemsController.editController.adapter.getCommentable();n(g.constructor)};o.W.app.on(t,a)})}const So=new dr({actionPoint:"updateRequests.addComment",install:n=>{let t=null;return Oo().then(o=>{t=new hr(o.prototype,"addComment",async function(a,y,...g){const S=await n({updateRequestId:this.conversation.getID(),message:y});return a(S.message,...g)}),t.enable()}),()=>{t==null||t.disable()}}});function Mo(n){return"subActions"in n&&Array.isArray(n.subActions)}const Eo=["bigJunctions","cities","countries","editSuggestions","junctions","majorTrafficEvents","managedAreas","mapComments","mapProblems","mapUpdateRequests","nodes","onlineEditors","permanentHazards","problemDetails","restrictedDrivingAreas","restrictedEditingAreas","roadClosures","schedules","segments","segmentHouseNumbers","segmentSuggestions","signTypes","states","streets","turnClosures","updateRequestSessions","users","userAreas","venues"];function Mt(n,t){if(typeof n!="object"||n===null)return t;if(Array.isArray(n)&&Array.isArray(t))return[...n,...t];const o={...n};for(const a in t)t[a]!==void 0&&(a in o&&typeof o[a]=="object"?o[a]=Mt(o[a],t[a]):o[a]=t[a]);return o}function jo(n,t){if(!n||!t){const y=n||t;if(!y)throw new Error("Both responses are null or undefined");return y}const o=Et(n),a=Et(t);if(o&&a)return{pendingEdits:n.pendingEdits||t.pendingEdits,saveCount:{bigJunctions:n.saveCount.bigJunctions+t.saveCount.bigJunctions,nodes:n.saveCount.nodes+t.saveCount.nodes,segments:n.saveCount.segments+t.saveCount.segments,venues:n.saveCount.venues+t.saveCount.venues},unsavedFeatures:[...n.unsavedFeatures,...t.unsavedFeatures]};if(!o&&!a)return{...[...Eo,"connections"].reduce((y,g)=>{const S=n[g],O=t[g];return S&&O?y[g]=Mt(S,O):S?y[g]=S:O&&(y[g]=O),y},{}),status:n.status,synced:n.synced,unsavedFeatures:Mt(n.unsavedFeatures,t.unsavedFeatures)};throw new To(n,t)}function Et(n){return"saveCount"in n}class To extends Error{constructor(t,o){super("Responses have different versions"),this.a=t,this.b=o}get preferredResponse(){return Et(this.a)?this.b:this.a}}function pr(n,t){const o=[];if(typeof t!="function"){const a=t;t=y=>a===y}for(const a in n){const y=n[a];if(t(y))return o.concat(parseInt(a));if(y.subActions){const g=pr(y.subActions,t);if(g)return o.concat(parseInt(a),...g)}}return null}class lt{constructor(t){B(this,"actions"),this.actions=t}getActionsFlat(){return this.actions.flatMap(t=>Mo(t)?t.getSubActions():[t])}getActionPath(t){return pr(this.actions,t)}hasAction(t){return this.getActionPath(t)!==null}removeAction(t){var o;const a=t.pop();let y={subActions:this.actions};for(;t.length;)y=(o=y.subActions)==null?void 0:o[t.shift()];a!==void 0&&y.subActions.splice(a,1)}replaceAction(t,...o){var a;const y=t.pop();let g={subActions:this.actions};for(;t.length;)g=(a=g.subActions)==null?void 0:a[t.shift()];y!==void 0&&g.subActions.splice(y,1,...o)}addAction(t){this.actions.push(t)}}class Io{constructor(t,o){B(this,"saveInterceptor"),this.saveInterceptor=new hr(t.controller,"save",async function(a,y,...g){const S=new lt((y==null?void 0:y.actions)||this.model.actionManager.getActions()),O=await Promise.resolve(o(S));if(O){let T=null;for(const $ of O){const I=await a({...y||{},actions:$.actions},...g);T?T=jo(T,I):T=I}return T}return a({...y||{},actions:S.actions},...g)})}enable(){return this.saveInterceptor.enable()}disable(){return this.saveInterceptor.disable()}}const Po="ADD_ROAD_CLOSURE";function jt(n){return(n==null?void 0:n.actionName)===Po&&(n==null?void 0:n.closure)!==void 0&&(n==null?void 0:n.segment)!==void 0}const Ro="ADD_TURN_CLOSURE";function Tt(n){var t;return n.actionName===Ro&&((t=n.getObject())==null?void 0:t.type)==="turnClosure"}function yr(n){return n.actionName==="UPDATE_OBJECT"}function wr(n){var t;return yr(n)&&((t=n.object)==null?void 0:t.type)==="roadClosure"}function _r(n){var t;return yr(n)&&((t=n.object)==null?void 0:t.type)==="turnClosure"}const Ao="DELETE_ROAD_CLOSURE";function It(n){return(n==null?void 0:n.actionName)===Ao&&(n==null?void 0:n.closure)!==void 0&&(n==null?void 0:n.segment)!==void 0}function xo(n){return n.actionName==="DELETE_OBJECT"}function Pt(n){return xo(n)&&n.object.type==="turnClosure"}function $o(n){return n.filter(t=>jt(t)||Tt(t)||wr(t)||_r(t)||It(t)||Pt(t))}const Do={roadClosure:"SEGMENT",turnClosure:"TURN"};function Xe(n){const t={id:n.state==="INSERT"?null:n.attributes.id,closureType:Do[n.type],startDate:new Date(n.attributes.startDate),endDate:new Date(n.attributes.endDate),description:n.attributes.reason,eventId:n.attributes.eventId};switch(n.type){case"roadClosure":return{...t,closureType:"SEGMENT",permanent:n.getAttribute("permanent"),segmentId:n.getAttribute("segID"),forward:n.getAttribute("forward"),nodeClosure:n.getAttribute("fromNodeClosed"),provider:n.getAttribute("provider")};case"turnClosure":return{...t,closureType:"TURN",permanent:!0,fromSegmentId:n.getAttribute("fromSegID"),fromSegmentForward:n.getAttribute("fromSegForward"),toSegmentId:n.getAttribute("toSegID"),toSegmentForward:n.getAttribute("toSegForward"),nodeId:n.getAttribute("nodeConnID")}}}function gr(n,t){return typeof n!=typeof t||typeof n!="object"||!n||!t?!1:Object.keys(n).every(o=>{if(!Object.prototype.hasOwnProperty.call(t,o))return!1;const a=n[o],y=t[o];return gr(a,y)})}function Fo(n,t){return t.some(o=>gr(o,n))}function vr(n,t){return n.length!==t.length?!1:n.every(o=>Fo(o,t))}var Vo=Object.defineProperty,Co=(n,t,o)=>t in n?Vo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,et=(n,t,o)=>Co(n,typeof t!="symbol"?t+"":t,o);let zo=class{constructor(n,t){et(this,"_target"),et(this,"_key"),et(this,"_oldValue"),et(this,"_wasDefined",!1),et(this,"_isSwapped",!1),this._target=n,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(n){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=n,this._isSwapped=!0}};function Rt(){return"unsafeWindow"in window?window.unsafeWindow:window}var Ko=Object.defineProperty,Wo=(n,t,o)=>t in n?Ko(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,br=(n,t,o)=>Wo(n,typeof t!="symbol"?t+"":t,o);function tt(){return"unsafeWindow"in window?window.unsafeWindow:window}var No=Object.defineProperty,Ho=(n,t,o)=>t in n?No(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ze=(n,t,o)=>Ho(n,typeof t!="symbol"?t+"":t,o);class Uo{constructor(t,o){ze(this,"_target"),ze(this,"_key"),ze(this,"_oldValue"),ze(this,"_wasDefined",!1),ze(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}class qo{constructor(t,o,a){ze(this,"_enabled",!1),ze(this,"_fnSwapper"),ze(this,"_interceptionFunction"),ze(this,"_middlewares",[]),this._fnSwapper=new Uo(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}}class Lo{constructor(t){br(this,"_fetchInterceptor"),br(this,"_interceptionFilters",new Set),this._fetchInterceptor=new qo(t,"fetch",(o,a,y)=>{for(const g of this._interceptionFilters)if(g.shouldIntercept(a,y))return this.shouldKeepFilter(g,a,y)||this.removeInterceptionFilter(g),g.intercept(a,y);return o(a,y)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}}function Go(n){return n=n instanceof URL?n:new URL(n,tt().location.href),t=>typeof t=="string"?new URL(t,tt().location.href).pathname===n.pathname:t instanceof URL?t.pathname===n.pathname:new URL(t.url,tt().location.href).pathname===new URL(n,tt().location.href).pathname}function Bo(n,t,o){const a=new Response(t,o),y=new URL(n,location.toString());return Object.defineProperty(a,"url",{value:y}),a}function Jo(n,t){const o=JSON.stringify(t),a=new Headers({"Content-Type":"application/json"});return Bo(n,o,{headers:a})}const Zo=new Lo(tt());function Yo(n){return!("descartesHttpClient"in n)&&"createAbortController"in n&&typeof n.createAbortController=="function"}function Qo(){const n=Rt().W.controller.descartesClient,t=Yo(n)?n:n.descartesHttpClient,o=new zo(t,"createAbortController");o.swap(()=>(o.restore(),new AbortController))}function Xo(n){const t=Rt();return Qo(),t.W.controller.descartesClient.getFeatures([0,0,0,0],{[n]:!0},{})}async function mr(n,t){const o=Rt().W.Config.paths.features;Zo.addInterceptionFilter({shouldIntercept:Go(o),intercept(){return Promise.resolve(Jo(o,{[n]:{objects:[t]}}))}});const{[n]:a}=await Xo(n),[y]=a.objects;return y.constructor}const kr=Symbol("TurnClosure"),Or=Symbol("RoadClosure");function Sr(n){const t=n.getFullYear().toString().padStart(4,"0"),o=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0"),y=n.getHours().toString().padStart(2,"0"),g=n.getMinutes().toString().padStart(2,"0");return`${t}-${o}-${a} ${y}:${g}`}function ea(n){const t=Qe(),o={SEGMENT:"roadClosure",TURN:"turnClosure"};return t.W.model.getRepository(o[n])}function ta(n,t){const o={id:n.id||ea(n.closureType).idGenerator.next(),attributions:null,reason:n.description,startDate:Sr(n.startDate),endDate:Sr(n.endDate),eventId:n.eventId,externalProvider:null,externalProviderId:null,provider:null,createdBy:null,createdOn:null,updatedBy:null,updatedOn:null,permissions:-1,geometry:null};switch(n.closureType){case"SEGMENT":return new t[Or]({...o,closureType:"SEGMENT",permanent:n.permanent,segID:n.segmentId,forward:n.forward,fromNodeClosed:n.nodeClosure});case"TURN":return new t[kr]({...o,closureType:"TURN",permanent:!0,fromSegID:n.fromSegmentId,fromSegForward:n.fromSegmentForward,toSegID:n.toSegmentId,toSegForward:n.toSegmentForward,nodeConnID:n.nodeId})}}function Mr(n){return jt(n)?{...Xe(n.closure),id:null}:Tt(n)?{...Xe(n.getObject()),id:null}:wr(n)?Xe(n.getObject()):It(n)?Xe(n.closure):_r(n)||Pt(n)?Xe(n.getObject()):null}const ra=[{async install(){const n=await mr("roadClosures",{});return{[Or]:n}}},{async install(){const n=await mr("turnClosures",{});return{[kr]:n}}},new dr({actionPoint:"closures.save",install:(n,t)=>{const o=Qe(),a=new Io(o.W,async y=>{var g,S;const O=y.getActionsFlat(),T=$o(O);if(!T.length)return;const{delete:$,set:I}=T.reduce((F,C)=>((It(C)||Pt(C)?F.delete:F.set).push(C),F),{delete:[],set:[]}),j={source:void 0,closures:I.map(Mr).filter(Boolean),deleteClosures:$.map(Mr).filter(Boolean)},A=await n(j),x=vr(j.closures,A.closures),W=vr(j.deleteClosures,A.deleteClosures);if(!x&&!W)return;const K=(g=T.find(F=>jt(F)))==null?void 0:g.constructor,P=(S=T.find(F=>Tt(F)))==null?void 0:S.constructor;T.forEach(F=>{const C=y.getActionPath(F);C&&(y.removeAction(C),F.undoAction(o.W.model))});const{addClosureActions:V,updateClosureActions:J}=A.closures.reduce((F,C)=>{const L=Qe(),G=ta(C,t);if(!G)return F;if(!C.id){const Z=(()=>{switch(C.closureType){case"SEGMENT":{if(!K){const pe=L.require("Waze/Action/CreateObject");return new pe(G)}const Y=L.W.model.segments.getObjectById(C.segmentId);return new K(G,Y)}case"TURN":{if(!P){const _e=L.require("Waze/Action/CreateObject");return new _e(G)}const Y=L.W.model.segments.getObjectById(C.fromSegmentId),pe=L.W.model.segments.getObjectById(C.toSegmentId);return new P(G,Y,pe)}default:throw new Error("Unregistered closure factory for closure type "+C.closureType)}})();Z&&F.addClosureActions.push(Z)}const ye=(()=>{const Z=L.W.model.getRepository(C.closureType==="SEGMENT"?"roadClosure":"turnClosure").getObjectById(C.id);if(!Z)return null;const Y=L.require("Waze/Action/UpdateObject");return new Y(Z,G.attributes)})();return ye&&F.updateClosureActions.push(ye),F},{addClosureActions:[],updateClosureActions:[]}),we=A.deleteClosures.map(F=>{const C=Qe(),L=C.W.model.getRepository(F.closureType==="SEGMENT"?"roadClosure":"turnClosure").getObjectById(F.id);if(!L)return null;const G=C.require("Waze/Action/DeleteObject");return new G(L)});return[new lt(J.filter(Boolean)),new lt(we.filter(Boolean)),new lt(V.filter(Boolean))].filter(F=>F.actions.length>0)});return a.enable(),()=>{a.disable()}}})],na=[{install:({sdk:n})=>({[St]:new vo(n)})},new ho("Events.registerMiddleware",({artifacts:n})=>(t,o)=>{const a=n[St];if(!a)throw new Error("Middleware registry not found in artifacts");return a==null?void 0:a.register(t,o)},{isFactory:!0}),So,...ra];function ia(n,t){if(!n||!t)return n===t;if(n.objectType!==t.objectType)return!1;const o=[...n.ids],a=[...t.ids];return o.length!==a.length?!1:(o.sort(),a.sort(),o.every((y,g)=>{const S=a[g];return y===S}))}function oa(n,t){return{eventName:n,effect:t}}const aa=oa("wme-feature-editor-rendered",({wmeSdk:n,trigger:t})=>{let o=null;const a=new MutationObserver(()=>{const g=n.Editing.getSelection();if(!g){o=null;return}ia(o,g)||(t({featureType:g.objectType}),o=g)}),y=document.querySelector("#edit-panel .contents");if(!y){console.warn("[WME SDK+]: Unable to find the edit panel's content node to observe");return}return a.observe(y,{childList:!0}),()=>{a.disconnect()}});var sa=Object.defineProperty,ua=(n,t,o)=>t in n?sa(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ke=(n,t,o)=>ua(n,typeof t!="symbol"?t+"":t,o);class ca{constructor(t,o){Ke(this,"_target"),Ke(this,"_key"),Ke(this,"_oldValue"),Ke(this,"_wasDefined",!1),Ke(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}class At{constructor(t,o,a){Ke(this,"_enabled",!1),Ke(this,"_fnSwapper"),Ke(this,"_interceptionFunction"),Ke(this,"_middlewares",[]),this._fnSwapper=new ca(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}}const Er=Symbol("EVENT CLEANUPS"),jr=[aa];function xt(n){return jr.some(t=>t.eventName===n)}const fa={"Editing.Transactions":{hook:Xr},"DataModel.MapComments":{hook:Dn},"DataModel.PermanentHazards":{hook:gi},"DataModel.BigJunctions":{hook:ro},Events:{hook:[{install({sdk:n,artifacts:t}){const o=n.Events.eventBus,a=[];jr.forEach(y=>{const g=y.effect({wmeSdk:n,eventBus:o,trigger(S){o.trigger(y.eventName,S)}});g&&a.push(g)}),t[Er]=a},uninstall({artifacts:n}){n[Er].forEach(t=>t())}},({sdk:n})=>{const t=new At(n.Events,"on",(o,a,...y)=>{const g=()=>o(a,...y),{eventName:S,eventHandler:O}=a;return y.length||!S||!xt(S)||!O?g():n.Events.eventBus.on(S,O)});return t.enable(),()=>t.disable()},({sdk:n})=>{const t=new At(n.Events,"once",(o,a,...y)=>{const g=()=>o(a,...y),{eventName:S}=a;return y.length||!S||!xt(S)?g():n.Events.eventBus.once(S)});return t.enable(),()=>t.disable()},({sdk:n})=>{const t=new At(n.Events,"off",(o,a,...y)=>{const g=()=>o(a,...y),{eventName:S,eventHandler:O}=a;return y.length||!S||!xt(S)||!O?g():n.Events.eventBus.off(S,O)});return t.enable(),()=>t.disable()}]},Middlewares:{hook:na}};function $t(n){const[t,o,a]=n.split(".").map(Number);return{major:t,minor:o,patch:a}}function Dt(n,t){return n?t?n.major&&t.major&&n.major!==t.major?n.major-t.major:n.minor&&t.minor&&n.minor!==t.minor?n.minor-t.minor:n.patch&&t.patch&&n.patch!==t.patch?n.patch-t.patch:0:1:-1}function la(n,t,o="highest"){let a=null;typeof n.highest=="string"&&(n.highest=$t(n.highest)),typeof n.lowest=="string"&&(n.lowest=$t(n.lowest));for(const y of t){if(!y.version)continue;if(!a){a=y;continue}if(n.highest&&Dt(y.version,n.highest)>0||n.lowest&&Dt(y.version,n.lowest)<0)continue;const g=y.version,S=a.version,O=Dt(g,S);(o==="highest"&&O>0||o==="lowest"&&O<0)&&(a=y)}if(!a)throw new Error("No matching version found");return a}const ha={"0.1":n=>{const t=n.constructor;return new t(n.getScriptId(),n.getScriptName())}};function da(n){const t=Object.entries(ha).map(([a,y])=>({version:$t(a),cloner:y})),{cloner:o}=la({highest:n.getSDKVersion()},t);return o(n)}const Tr=new Ar(fa);async function pa(n,t={}){if(t.immutable&&(n=da(n)),n.State.isInitialized()||await n.Events.once({eventName:"wme-initialized"}),t.hooks)for(const o of t.hooks)await Tr.installHook(o,n);else await Tr.installAllHooks(n);return n}return pa}();
